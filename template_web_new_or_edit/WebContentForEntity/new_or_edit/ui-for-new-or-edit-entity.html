<!DOCTYPE html>
<html lang="en" ng-app="page">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">

<title>${pageTitle}</title>

<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">

<style type="text/css">
  input:required:invalid, input:focus:invalid {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjNGNTlDOUMxMUVDNDExRTM4NDU4RjQ3Q0I3NkI4OTBDIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjNGNTlDOUMyMUVDNDExRTM4NDU4RjQ3Q0I3NkI4OTBDIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6M0Y1OUM5QkYxRUM0MTFFMzg0NThGNDdDQjc2Qjg5MEMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6M0Y1OUM5QzAxRUM0MTFFMzg0NThGNDdDQjc2Qjg5MEMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4Be44kAAAAqklEQVR42mL8//8/AyWAiYFCQLEBLNgEX+aURgGpAiA2gAqdB+KJ4lO6l6GrZUQPA6DmqUAqC4eF04CGZOP0AtRmkOZ/QHwLSeoWVCwLqgZnGORD6TtA7ArEp6DYFSqGrAZrGBhCaTUgXg3EoVD+aqgYshraRON5JD+HQm2GueQWmhqsBkyE0ipAvBuIzaB4N1QMWQ11opERW16ARlU+UoARn5CGXmYCCDAAPz09iI0KJ9QAAAAASUVORK5CYII=");
    background-position: right top;
    background-repeat: no-repeat;
    -moz-box-shadow: none;
  }
  input:required:valid {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjdEMjg0RkIyMUVFMzExRTM4NDU4RjQ3Q0I3NkI4OTBDIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjdEMjg0RkIzMUVFMzExRTM4NDU4RjQ3Q0I3NkI4OTBDIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6N0QyODRGQjAxRUUzMTFFMzg0NThGNDdDQjc2Qjg5MEMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6N0QyODRGQjExRUUzMTFFMzg0NThGNDdDQjc2Qjg5MEMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz54SgjJAAAAuUlEQVR42mL8//8/AyWAiYFCQFsDWrdcMAViY3xqWAhYEADEv4H4LLle8IVinIARORaAzpUHiUG5qkC8C8p2AOKHQPwDhKt9DD7gcoEREJ8H4vtImkHgAFTsKhB743QB1BWyQGo+EDujGb4JiNOBtr/AawDUEH0gdQFNWBGo+QGxgRgEpV8C8SsoO4KUWAAZsAeIDYBYB4g3A3EUwViAOl8Falsb0Mn/kMRTQYYCxe4TDIOhlZkAAgwAunFAhB2QB2cAAAAASUVORK5CYII=");
    background-position: right top;
    background-repeat: no-repeat;
  }
</style>
</head>
<body style="margin-left: 20px">
<div ng-include="'header.html'"></div>

	<div id="wrap" ng-controller="NewOrEditController">
		<div class="row">
			<div class="col-lg-12">
		    	<h1 class="page-header">${pageTitle}</h1>
			</div>
		</div>
		<div class="container well">
            <div>
            	<div class="alert alert-danger" ng-show="errorMessage">
                    <strong>Oh snap!</strong> {{errorMessage}}
                </div>
                <div class="alert alert-success" ng-show="successfullyUpdated">
                    <strong>Well done!</strong> Entity successfully updated!
                </div>
                <div>
#foreach ($tableColumn in $tableColumns)
#if($tableColumn.isVisible())
					<label>${tableColumn.getLabel()}</label> 
#if ($tableColumn.isKey())
                    <input type="text" class="form-control" ng-model="entity.${tableColumn.getName()}" readonly>
#else
#if ($tableColumn.getWidgetType() == "date")
					<p class="input-group">
		            	<input type="text" ng-model="entity.${tableColumn.getName()}" class="form-control ng-pristine ng-valid ng-isolate-scope ng-valid-required ng-touched" 
		               		uib-datepicker-popup="" is-open="${tableColumn.getName()}Status.opened" 
		               		datepicker-options="dateOptions" date-disabled="disabled(date, mode)" ng-required="true" close-text="Close" 
		               		required="required" style="">
				        <span class="input-group-btn">
				        	<button type="button" class="btn btn-default" ng-click="${tableColumn.getName()}Open($event)"><i class="glyphicon glyphicon-calendar"></i></button>
				        </span>
		           	</p>
#elseif ($tableColumn.getWidgetType() == "textarea")
					<textarea class="form-control" 
						ng-model="entity.${tableColumn.getName()}" cols="50" rows="5" required="required"></textarea>
#elseif ($tableColumn.getWidgetType() == "dropdown")
					<input type="hidden" class="form-control" ng-model="entry.${tableColumn.getName()}" required="required">
					<div>
						<select class="form-control" ng-model="entry.${tableColumn.getName()}" ng-options="option.item_id as option.item_name for option in items" ng-disabled="operation == 'show'" required="required"></select>	
					</div>
#elseif ($tableColumn.getWidgetType() == "list")
					<input type="hidden" class="form-control" ng-model="entry.${tableColumn.getName()}" ng-readonly="operation == 'show'" required="required">
					<div>
						<select class="form-control" multiple="true" ng-model="entry.${tableColumn.getName()}" ng-options="option.item_id as option.item_name for option in items" ng-disabled="operation == 'show'" required="required"></select>	
					</div>
#elseif ($tableColumn.getWidgetType() == "integer")
					<input type="number" class="form-control" pattern="\d*" step="1"
						ng-model="entity.${tableColumn.getName()}" required="required">
#elseif ($tableColumn.getWidgetType() == "float")
					<input type="number" class="form-control" pattern="[0-9]+([\.,][0-9]+)?" step="0.01"
						ng-model="entity.${tableColumn.getName()}" required="required">
#else
					<input type="text" class="form-control" ng-model="entity.${tableColumn.getName()}" required="required">
#end
#end
					<br>
#end
#end                      
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary btn-sm" ng-click="saveEntity()" ng-show="!exist">Save</button>
                        <button type="button" class="btn btn-primary btn-sm" ng-click="updateEntity()" ng-show="exist">Update</button>
                        <button type="button" class="btn btn-default btn-sm" ng-click="cancelUpdate()">Cancel</button>
                    </div>
                </div>

        </div>
    </div>

	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.7/angular.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.7/angular-resource.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.7/angular-animate.min.js"></script>
	<script src="https://angular-ui.github.io/bootstrap/ui-bootstrap-tpls-0.14.3.js"></script>

	<script type="text/javascript">
	
		function getURLParameter(name) { 
			return decodeURIComponent((
				new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)
				|| [,""])[1].replace(/\+/g, '%20'))|| null; 
	    }
	
		angular.module('page', ['ngAnimate', 'ui.bootstrap']);
		angular.module('page').controller('NewOrEditController', function ($scope, $http) {
			var url = '${serviceFileName}';
#foreach ($tableColumn in $tableColumns)
#if ($tableColumn.isKey())
	  		$scope.primaryKey = '${tableColumn.getName()}';
#end
#end
			$scope.urlParameter = getURLParameter($scope.primaryKey);
	        $scope.exist = $scope.urlParameter !== null;
	        $scope.errorMessage = null;
	        $scope.successfullyUpdated = false;
	                    
	        if($scope.urlParameter){
	        	var getUrl = url + '?' + $scope.primaryKey + '=' + $scope.urlParameter;
	
	        	$http.get(getUrl)
	        	.success(function(response){
	            	$scope.entity=response;    
				}).error(function(response){
	            	$scope.exist = false;
				});
			}
	        
			/* ---- Uncomment and configure in case of using dropdown or list widgets in the form above  ----
			
			var urlItems = 'ENDPOINT_OF_THE_ITEMS_SERVICE';
				
			$http.get(urlItems)
				.success(function(items){
					$scope.items = items;
				});
			*/

	        $scope.saveEntity = function(){
	        	$http.post(url ,$scope.entity)
	        	.success(function(response){
	            	var documentURL = document.URL.toString();
					documentURL = documentURL.substring(0, documentURL.lastIndexOf('=')+1);
	            	documentURL+=parseInt(response);
	                window.location = documentURL;
	                $scope.errorMessage = null;
				}).error(function(response){
	            	$scope.errorMessage = response.err.message;
				});
			}
	                    
	        $scope.updateEntity = function(){
	        	$http.put(url, $scope.entity)
	        	.success(function (response){
	        		$scope.successfullyUpdated = true;
	                $scope.errorMessage = null;
	            }).error(function(response){
	                $scope.successfullyUpdated = false;
	                $scope.errorMessage = response.err.message;
	            });
			}
	                    
	        $scope.cancelSave = function(){
	            $scope.entity = {};
			}
	
	        $scope.cancelUpdate = function(){
	        	$scope.errorMessage = null;
	        	
	        	$http.get(getUrl)
	        	.success(function(response){
					$scope.entity=response;    
				}).error(function(response){
	            	$scope.exist = false;
				});
			}
	        
	        $scope.dateOptions = {
					startingDay: 1
			};
			$scope.formats = ['yyyy/MM/dd', 'dd-MMMM-yyyy', 'dd.MM.yyyy', 'shortDate'];
  			$scope.format = $scope.formats[0];
	        
#foreach ($tableColumn in $tableColumns) 
#if ($tableColumn.getWidgetType() == "date")
			$scope.${tableColumn.getName()}Open = function($event) {
				$scope.${tableColumn.getName()}Status.opened = true;
			};
			$scope.${tableColumn.getName()}Status = {
				opened: false
			};
#end
#end
	                    
		});
	</script>
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
	<script>
	  $( document ).ready(function() {
	    $\.getJSON("main.menu", function(data) {
			$\.each(data, function(i, item) {
				var itemContent = "";
				if (item.subMenu.length > 0) {
					itemContent += "<li class=\"dropdown\"><a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">" + item.name + " <b class=\"caret\"></b></a>";
					itemContent += "<ul class=\"dropdown-menu\">";
					$\.each(item.subMenu, function(j, subitem) {
						itemContent += "<li><a href=\"" + subitem.link + "\" >" + subitem.name + "</a></li>";
					});
					itemContent += "</ul>";
				} else {
					itemContent += "<li><a href=\"" + item.link + "\" >" + item.name + "</a>";
				}
				itemContent += "</li>";
				$("#main-menu").append(itemContent);
			});
		});
	  });
	</script>

<div ng-include="'footer.html'"></div>
</body>
</html>
